<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Portfolio acad√©mique ‚Äì Objectifs, comp√©tences, cours, projets, preuves, r√©flexions et plan d'action." />
    <title>Portfolio acad√©mique</title>
    <link rel="stylesheet" href="../styles.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <header class="site-header">
      <nav class="nav container" aria-label="Navigation principale">
        <a href="#intro" class="brand" aria-label="Aller au d√©but"></a>
        <ul class="nav-links">
          <li><a href="#intro" data-i18n="nav.presentation">Pr√©sentation</a></li>
          <li><a href="#cours" data-i18n="nav.cours">Cours</a></li>
          <li><a href="#projets" data-i18n="nav.projets">Projets</a></li>
          <li><a href="#cv-contact" data-i18n="nav.cvcontact">CV & Contact</a></li>
        </ul>
        <div class="nav-actions">
          <button id="themeToggle" class="icon-btn" aria-label="Basculer le th√®me" aria-pressed="false" title="Th√®me clair/sombre">
            <span class="icon">üåì</span>
          </button>
          <button id="langToggle" class="icon-btn" aria-label="Basculer la langue" title="FR/EN">FR</button>
          <button class="icon-btn nav-toggle" aria-label="Ouvrir/fermer le menu">‚ò∞</button>
        </div>
      </nav>
    </header>

    <main>
      <section id="intro" class="section hero">
        <div class="container">
          <p class="eyebrow" data-i18n="hero.eyebrow">Portfolio ISS</p>
          <h1>Loubejac Combalbert Jean-Philippe</h1>
        </div>
      </section>

      <section id="objectifs" class="section alt">
        <div class="container">
          <h2 data-i18n="objectifs.title">Pourquoi avoir rejoint ISS ?</h2>
          <div class="card">
            <p class="muted" data-i18n="objectifs.text">petit texte sympathique</p>
          </div>
        </div>
      </section>

      <section id="cours" class="section alt">
        <div class="container">
          <h2 data-i18n="cours.title">Cours/UE suivis et r√©sultats d'apprentissage</h2>
          <p class="muted" data-i18n="cours.hint">Cliquez sur un cours pour voir les d√©tails</p>
          <ol class="timeline" id="courses-timeline" aria-label="Parcours acad√©mique d√©taill√©">
            <!-- Les cours seront g√©n√©r√©s ici par JavaScript -->
          </ol>
        </div>
      </section>

      <section id="projets" class="section">
        <div class="container">
          <div class="section-header">
            <h2 data-i18n="projets.title">Projets acad√©miques</h2>
          </div>
          <div class="grid projects-grid">
            <article class="card project" data-type="academic" data-tags="web,data">
              <div class="project-header">
                <h3 data-i18n="project.card.title">Titre du projet</h3>
                <span class="project-type project-type-academic" data-i18n="project.type.academic">Acad√©mique</span>
              </div>
              <p data-i18n="project.summary">R√©sum√© (contexte, objectifs, m√©thodologie, r√©sultats, limites).</p>
              <ul class="tags"><li data-i18n="project.tags.methodo">M√©thodo</li><li data-i18n="project.tags.technos">Technos</li><li data-i18n="project.tags.role">R√¥le</li></ul>
              <div class="links">
                <a class="btn sm" href="#" target="_blank" rel="noopener" data-i18n="links.report">Rapport</a>
                <a class="btn sm" href="#" target="_blank" rel="noopener" data-i18n="links.code">Code</a>
                <a class="btn sm" href="#" target="_blank" rel="noopener" data-i18n="links.demo">D√©mo</a>
              </div>
            </article>
            <!-- Dupliquez la carte pour d'autres projets -->
          </div>
        </div>
      </section>

      <!-- <section id="preuves" class="section alt">
        <div class="container">
          <h2>Preuves et attestations</h2>
          <div class="card">
            <p class="muted">Liez ici des artefacts: attestations, certificats, rapports, captures d'√©cran, liens vers d√©p√¥ts, etc. Anonymisez les donn√©es sensibles et citez les sources si n√©cessaire.</p>
            <ul>
              <li><a href="#">Certification / Attestation (PDF)</a></li>
              <li><a href="#">Rapport de projet</a></li>
              <li><a href="#">D√©p√¥t Git</a></li>
            </ul>
          </div>
        </div>
      </section> -->

      <!-- <section id="reflexion" class="section">
        <div class="container">
          <h2>R√©flexion critique</h2>
          <div class="card">
            <p>Analysez vos r√©ussites, difficult√©s, feedbacks re√ßus et axes d'am√©lioration. Reliez aux objectifs initiaux.</p>
          </div>
        </div>
      </section> -->

      <!-- <section id="plan" class="section alt">
        <div class="container">
          <h2>Plan d'action / Progression</h2>
          <div class="card">
            <ul>
              <li>√âtape 1 ‚Äì Action ‚Äì √âch√©ance ‚Äì Indicateur de r√©ussite</li>
              <li>√âtape 2 ‚Äì Action ‚Äì √âch√©ance ‚Äì Indicateur de r√©ussite</li>
            </ul>
          </div>
        </div>
      </section> -->
        <section id="contact" class="section">
          <div class="container">
            <h2 data-i18n="contact.title">Contact</h2>
              <ul class="contact-list"></ul>
          </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p>¬© <span id="year"></span> <span data-i18n="footer.text">Portfolio acad√©mique</span></p>
      </div>
    </footer>

    <!-- Modale pour les d√©tails des cours -->
    <div id="courseModal" class="modal" aria-hidden="true">
      <div class="modal-content">
          <div class="modal-header">
          <div class="modal-header-text">
            <h2 id="modalCourseTitle" style="margin-bottom: 4px;">Titre du cours</h2>
            <p id="modalCourseMeta" class="muted" style="margin: 0; font-size: 0.95rem;"></p>
          </div>
          <button class="modal-close" aria-label="Fermer" data-i18n-attr="aria-label:modal.close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="modal-body-layout">
            <aside class="modal-sidebar">
              <div class="modal-sidebar-sticky" id="modalSidebarContent">
                <!-- Generated by JS -->
              </div>
            </aside>
            <div class="modal-content-scroll">
              <div id="tab-context" class="detail-section active">
                <h3 data-i18n="modal.tabs.context">Contexte</h3>
                <div id="modalContext"></div>
              </div>
              <div id="tab-technique" class="detail-section">
                <h3 data-i18n="modal.tabs.technique">Technique</h3>
                <div id="modalTechnique"></div>
              </div>
              <div id="tab-analyse" class="detail-section">
                <h3 data-i18n="modal.tabs.analyse">Analyse</h3>
                <div id="modalAnalyse"></div>
              </div>
              <div id="tab-competences" class="detail-section">
                <h3 data-i18n="modal.tabs.competences">Comp√©tences</h3>
                <div class="table-responsive">
                  <table class="skills-table" style="width: 100%; border-collapse: collapse;">
                    <thead>
                      <tr style="border-bottom: 1px solid var(--border); text-align: left;">
                        <th style="padding: 12px;" data-i18n="skills.header.skill">Comp√©tence</th>
                        <th style="padding: 12px;" data-i18n="skills.header.note">Note</th>
                        <th style="padding: 12px;" data-i18n="skills.header.comment">Commentaires</th>
                      </tr>
                    </thead>
                    <tbody id="modalSkillsBody">
                      <!-- Les comp√©tences seront g√©n√©r√©es ici par JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="data.js"></script>
    <script src="../script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const data = window.__ACADEMIC_DATA__;
        const timeline = document.getElementById('courses-timeline');
        const modal = document.getElementById('courseModal');
        const closeBtn = document.querySelector('.modal-close');
        const langBtn = document.getElementById('langToggle');

        // Elements de la modale
        const mTitle = document.getElementById('modalCourseTitle');
        const mMeta = document.getElementById('modalCourseMeta');
        const mContext = document.getElementById('modalContext');
        const mTechnique = document.getElementById('modalTechnique');
        const mAnalyse = document.getElementById('modalAnalyse');
        const mSkillsBody = document.getElementById('modalSkillsBody');
        const mSidebarContent = document.getElementById('modalSidebarContent');

        // i18n dictionnaire
        let lang = localStorage.getItem('lang') || 'fr';
        document.documentElement.lang = lang;
        const i18n = {
          fr: {
            'nav.presentation': 'Pr√©sentation',
            'nav.cours': 'Cours',
            'nav.projets': 'Projets',
            'nav.cvcontact': 'CV & Contact',
            'hero.eyebrow': 'Portfolio ISS',
            'objectifs.title': 'Pourquoi avoir rejoint ISS ?',
            'objectifs.text': 'petit texte sympathique',
            'cours.title': "Cours/UE suivis et r√©sultats d'apprentissage",
            'cours.hint': 'Cliquez sur un cours pour voir les d√©tails',
            'projets.title': 'Projets acad√©miques',
            'project.card.title': 'Titre du projet',
            'project.type.academic': 'Acad√©mique',
            'project.summary': 'R√©sum√© (contexte, objectifs, m√©thodologie, r√©sultats, limites).',
            'project.tags.methodo': 'M√©thodo',
            'project.tags.technos': 'Technos',
            'project.tags.role': 'R√¥le',
            'links.report': 'Rapport',
            'links.code': 'Code',
            'links.demo': 'D√©mo',
            'contact.title': 'Contact',
            'footer.text': 'Portfolio acad√©mique',
            'modal.close': 'Fermer',
            'modal.tabs.context': 'Contexte',
            'modal.tabs.technique': 'Technique',
            'modal.tabs.analyse': 'Analyse',
            'modal.tabs.competences': 'Comp√©tences',
            'skills.header.skill': 'Comp√©tence',
            'skills.header.note': 'Note',
            'skills.header.comment': 'Commentaires',
            'skills.none': 'Aucune comp√©tence renseign√©e.',
            'default.context_empty': 'Contexte non renseign√©.',
            'default.technique_empty': 'D√©tails techniques non renseign√©s.',
            'default.analyse_empty': 'Analyse non renseign√©e.'
          },
          en: {
            'nav.presentation': 'Overview',
            'nav.cours': 'Courses',
            'nav.projets': 'Projects',
            'nav.cvcontact': 'CV & Contact',
            'hero.eyebrow': 'ISS Portfolio',
            'objectifs.title': 'Why did I join ISS?',
            'objectifs.text': 'short friendly text',
            'cours.title': 'Courses and learning outcomes',
            'cours.hint': 'Click a course to see details',
            'projets.title': 'Academic projects',
            'project.card.title': 'Project title',
            'project.type.academic': 'Academic',
            'project.summary': 'Summary (context, goals, method, results, limits).',
            'project.tags.methodo': 'Method',
            'project.tags.technos': 'Tech',
            'project.tags.role': 'Role',
            'links.report': 'Report',
            'links.code': 'Code',
            'links.demo': 'Demo',
            'contact.title': 'Contact',
            'footer.text': 'Academic portfolio',
            'modal.close': 'Close',
            'modal.tabs.context': 'Context',
            'modal.tabs.technique': 'Technical',
            'modal.tabs.analyse': 'Analysis',
            'modal.tabs.competences': 'Skills',
            'skills.header.skill': 'Skill',
            'skills.header.note': 'Grade',
            'skills.header.comment': 'Comments',
            'skills.none': 'No skills provided.',
            'default.context_empty': 'Context not provided.',
            'default.technique_empty': 'Technical details not provided.',
            'default.analyse_empty': 'Analysis not provided.'
          }
        };

        const t = (key) => i18n[lang][key] || i18n['fr'][key] || key;
        const trField = (val) => {
          if (val && typeof val === 'object' && !Array.isArray(val)) {
            return val[lang] || val['fr'] || Object.values(val)[0];
          }
          return val;
        };

        function applyStaticTranslations() {
          document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            el.textContent = t(key);
          });
          document.querySelectorAll('[data-i18n-attr]').forEach(el => {
            const spec = el.getAttribute('data-i18n-attr'); // e.g., "aria-label:modal.close"
            const [attr, key] = spec.split(':');
            el.setAttribute(attr, t(key));
          });
          // Update timeline aria-label
          if (timeline) timeline.setAttribute('aria-label', lang === 'fr' ? 'Parcours acad√©mique d√©taill√©' : 'Academic journey details');
          // Update button label
          if (langBtn) langBtn.textContent = lang.toUpperCase();
          document.documentElement.lang = lang;
        }

        function renderTimeline() {
          if (!data || !data.courses || !timeline) return;
          timeline.innerHTML = '';
          data.courses.forEach(course => {
            const li = document.createElement('li');
            li.className = 'timeline-item course-item';
            li.dataset.courseId = course.id;

            const tagsHtml = (course.tags || []).map(tag => `<li>${trField(tag)}</li>`).join('');

            li.innerHTML = `
              <div class="tl-header">
                <h3>${trField(course.title)}</h3>
                <span class="muted">${trField(course.meta)}</span>
              </div>
              <p>${trField(course.description)}</p>
              <ul class="tags">${tagsHtml}</ul>
            `;

            li.addEventListener('click', () => openModal(course));
            timeline.appendChild(li);
          });
        }

        function renderSidebar(activeCourseId) {
          mSidebarContent.innerHTML = '';
          if (data && data.courses) {
            data.courses.forEach(course => {
              const courseItem = document.createElement('div');
              courseItem.className = 'nav-course-item';

              const courseBtn = document.createElement('button');
              courseBtn.className = 'nav-course-btn';
              if (course.id === activeCourseId) courseBtn.classList.add('active');
              courseBtn.textContent = trField(course.title);
              courseBtn.onclick = () => openModal(course);

              courseItem.appendChild(courseBtn);

              if (course.id === activeCourseId) {
                const sectionsContainer = document.createElement('div');
                sectionsContainer.className = 'nav-course-sections';

                const sections = [
                  { id: 'context', label: t('modal.tabs.context') },
                  { id: 'technique', label: t('modal.tabs.technique') },
                  { id: 'analyse', label: t('modal.tabs.analyse') },
                  { id: 'competences', label: t('modal.tabs.competences') }
                ];

                sections.forEach(sec => {
                  const secBtn = document.createElement('button');
                  secBtn.className = 'nav-section-btn';
                  secBtn.textContent = sec.label;
                  secBtn.onclick = (e) => {
                    e.stopPropagation();
                    scrollToSection(sec.id);
                  };
                  sectionsContainer.appendChild(secBtn);
                });

                courseItem.appendChild(sectionsContainer);
              }

              mSidebarContent.appendChild(courseItem);
            });
          }
        }

        // Gestion de la navigation (Scroll)
        function scrollToSection(targetId) {
          const section = document.getElementById(`tab-${targetId}`);
          if (section) {
            section.scrollIntoView({ behavior: 'smooth' });
          }
        }

        function openModal(course) {
          // Remplir la modale avec les donn√©es de l'objet course
          mTitle.textContent = trField(course.title);
          mMeta.textContent = trField(course.meta);
          mContext.innerHTML = trField(course.details?.context) || t('default.context_empty');
          mTechnique.innerHTML = trField(course.details?.technique) || t('default.technique_empty');
          mAnalyse.innerHTML = trField(course.details?.analyse) || t('default.analyse_empty');

          // Remplir le tableau des comp√©tences
          mSkillsBody.innerHTML = '';
          if (course.details?.competences && Array.isArray(course.details.competences)) {
            course.details.competences.forEach(skill => {
              const tr = document.createElement('tr');
              tr.style.borderBottom = '1px solid var(--border)';
              tr.innerHTML = `
                <td style="padding: 12px; font-weight: 600;">${trField(skill.name)}</td>
                <td style="padding: 12px; color: var(--accent);">${trField(skill.grade)}</td>
                <td style="padding: 12px; color: var(--muted);">${trField(skill.comment)}</td>
              `;
              mSkillsBody.appendChild(tr);
            });
          } else {
             mSkillsBody.innerHTML = `<tr><td colspan="3" style="padding: 12px; text-align: center; color: var(--muted);">${t('skills.none')}</td></tr>`;
          }

          // Afficher
          modal.classList.add('show');
          document.body.style.overflow = 'hidden';

          // Render Sidebar
          renderSidebar(course.id);

          // Reset scroll
          const layoutScroll = document.querySelector('.modal-body-layout');
          if (layoutScroll) layoutScroll.scrollTop = 0;
        }

        function closeModal() {
          modal.classList.remove('show');
          document.body.style.overflow = '';
        }

        if (closeBtn) closeBtn.addEventListener('click', closeModal);

        // Fermer avec Echap
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && modal.classList.contains('show')) closeModal();
        });

        // Toggle langue
        if (langBtn) {
          langBtn.addEventListener('click', () => {
            lang = lang === 'fr' ? 'en' : 'fr';
            localStorage.setItem('lang', lang);
            applyStaticTranslations();
            renderTimeline();
          });
        }

        // Initial render
        applyStaticTranslations();
        renderTimeline();
      });
    </script>
  </body>
</html>
